---
title: "NYC Restaurant Inspection Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---
```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)
```

## Checked variable names
```{r}
data(rest_inspec)
names(rest_inspec)
```

## Japanese restaurants, filter
```{r}

jp_critical = rest_inspec |>
  mutate(
    inspection_date = ymd(inspection_date),
    score = suppressWarnings(as.numeric(score)),
    month = floor_date(inspection_date, "month"),
    season = case_when(
      month(inspection_date) %in% c(12, 1, 2) ~ "Winter",
      month(inspection_date) %in% c(3, 4, 5) ~ "Spring",
      month(inspection_date) %in% c(6, 7, 8) ~ "Summer",
      month(inspection_date) %in% c(9, 10, 11) ~ "Fall",
      TRUE ~ NA_character_
    )
  ) |>
  filter(
    cuisine_description == "Japanese",
    !is.na(inspection_date),
    !is.na(score),
    !is.na(boro),
    boro != "Missing",
    !is.na(zipcode),
    !is.na(season),
    !is.na(critical_flag),
    critical_flag == "Y"   
  )
```


```{r}
# 1) per month x borough: number of critical cases
jp_monthly = jp_critical |>
  count(month, boro, name = "n_critical")

# 2) season x borough: number of critical cases
jp_seasonal = jp_critical |>
  count(season, boro, name = "n_critical")

# 3) ZIP codes: number of critical cases (top 15ï¼‰
jp_zip = jp_critical |>
  count(zipcode, name = "n_critical") |>
  arrange(desc(n_critical)) |>
  slice_head(n = 15)
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A: boxplot
```{r}
box_boro <- jp_critical |>
  plot_ly(
    x = ~boro,
    y = ~score,
    color = ~boro,
    type = "box",
    hoverinfo = "text",
    text = ~paste0(
      "Borough: ", boro,
      "<br>Score: ", score,
      "<br>Date: ", inspection_date
    )
  ) |>
  layout(
    xaxis = list(title = "Borough"),
    yaxis = list(title = "Inspection score (higher = worse)"),
    showlegend = FALSE,
    title = "Score distribution by borough (critical violations only)"
  )

box_boro
```
